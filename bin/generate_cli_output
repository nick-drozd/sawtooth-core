#!/bin/bash

if [ ! -e source/conf.py ]; then
    echo "Must be run from the sawtooth-core repo docs directory." 1>&2
    exit 1
fi

function save_usage() {
    safe_string=$(echo "$*" | sed -e 's/[^A-Za-z0-9-]/_/g')
    filename="source/cli/output/${safe_string}_usage.out"

    if ! help_output=$($@ -h); then
        exit 1
    fi

    echo "Generating: $filename"
    echo "$help_output" > "$filename"

    for subcommand in $(echo "$help_output" | grep '^.*{.*} \.\.\.' | sed 's/.*{//' | sed 's/[,}\.]/ /g'); do
        save_usage "$@ $subcommand"
    done
}

export PATH=$PATH:$(pwd)/../bin
mkdir -p source/cli/output

save_usage sawtooth
save_usage sawset
save_usage sawadm

save_usage sawtooth-validator
save_usage sawtooth-rest-api

save_usage settings-tp
save_usage identity-tp

save_usage poet

save_usage intkey
save_usage intkey-tp-python

save_usage xo
save_usage xo-tp-python
